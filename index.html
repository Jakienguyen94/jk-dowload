<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>T·ªïng h·ª£p ph·∫ßn m·ªÅm</title>
  <style>
    :root{
      --bg: #0b0b10;
      --card: #12121a;
      --muted: #8a8aa0;
      --text: #e9e9ef;
      --ring: #6b6bff;
      --border: #232336;

      /* button variables (overridden by theme) */
      --btn-bg: linear-gradient(135deg,#7c3aed, #06b6d4);
      --btn-bg-hover: linear-gradient(135deg,#6d28d9, #0891b2);
      --btn-text: #ffffff;
      --chip-bg: rgba(124,58,237,.15);
      --chip-text: #c4b5fd;
      --toggle-bg: rgba(124,58,237,.2);
      --toggle-dot: #7c3aed;
    }
    /* SIMPLE (t√≠m) theme overrides */
    .theme-simple{
      --btn-bg: #7c3aed;
      --btn-bg-hover: #6d28d9;
      --btn-text: #ffffff;
      --chip-bg: rgba(124,58,237,.15);
      --chip-text: #d6bcfa;
      --toggle-bg: #2a2340;
      --toggle-dot: #7c3aed;
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 70% -10%, #1e1e2a 0%, transparent 60%) , var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      line-height:1.45;
    }
    .container{
      max-width:1000px; margin:40px auto; padding:0 16px;
    }
    .header{
      display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      margin-bottom:18px;
    }
    .title{
      font-size: clamp(22px, 4vw, 32px);
      font-weight:800; letter-spacing: .2px;
      display:flex; align-items:center; gap:10px;
    }
    .title .dot{ width:10px; height:10px; border-radius:50%; background:var(--ring); box-shadow:0 0 16px var(--ring) }
    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .control{
      background: rgba(255,255,255,0.03);
      border:1px solid var(--border);
      border-radius:14px; padding:10px 12px;
      display:flex; align-items:center; gap:10px; min-height:44px;
    }
    .control input[type="search"]{
      background: transparent; color:var(--text);
      border:none; outline:none; width:220px; font-size:14px;
    }
    .control select{
      background: transparent; color:var(--text);
      border:none; outline:none; font-size:14px;
    }
    .theme-toggle{
      display:flex; gap:6px; background: rgba(255,255,255,0.04);
      border:1px solid var(--border); padding:6px; border-radius:14px;
    }
    .toggle-btn{
      cursor:pointer; user-select:none;
      padding:8px 12px; border-radius:10px; font-weight:600; font-size:13px;
      border:1px solid transparent;
      background:var(--toggle-bg);
      color:var(--text);
      transition: transform .12s ease, background .2s ease, border-color .2s ease;
    }
    .toggle-btn.active{
      border-color: var(--ring);
      box-shadow: 0 0 0 2px rgba(107,107,255,.15) inset;
      transform: translateY(-1px);
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid var(--border);
      border-radius:18px;
      overflow:hidden;
      box-shadow: 0 8px 30px rgba(0,0,0,.35);
    }
    table{
      width:100%; border-collapse:separate; border-spacing:0;
    }
    thead th{
      text-align:left; font-size:12px; letter-spacing:.08em; text-transform:uppercase;
      color:var(--muted); padding:14px 16px; background:rgba(255,255,255,.02);
      position: sticky; top:0; z-index:1; backdrop-filter: blur(6px);
      border-bottom:1px solid var(--border);
    }
    tbody td{
      padding:14px 16px; border-bottom:1px dashed rgba(255,255,255,.06);
      vertical-align: middle;
    }
    tbody tr:hover{ background: rgba(255,255,255,.02) }
    .col-stt{ width:72px }
    .name{
      font-weight:700; font-size:15px;
    }
    .tab-chip{
      display:inline-flex; align-items:center; gap:8px;
      font-size:12px; font-weight:700; letter-spacing:.02em;
      background: var(--chip-bg); color: var(--chip-text);
      padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.08);
    }
    .dl-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:12px; font-weight:800; letter-spacing:.2px;
      text-decoration:none; border:0; outline:0; cursor:pointer;
      background: var(--btn-bg); color: var(--btn-text);
      box-shadow: 0 10px 20px rgba(124,58,237,.25);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease, background .2s ease;
    }
    .dl-btn:hover{ transform: translateY(-1px); filter: saturate(1.05); box-shadow: 0 14px 28px rgba(124,58,237,.33); background: var(--btn-bg-hover) }
    .dl-btn svg{ width:18px; height:18px }

    .footer{
      padding:14px 16px; color:var(--muted); font-size:12px; text-align:right;
    }
    .empty{
      text-align:center; padding:36px; color:var(--muted)
    }
    .status{
      font-size:12px; color:var(--muted); margin:10px 2px 0;
    }

    @media (max-width:700px){
      .control input[type="search"]{ width:150px }
      .name{ font-size:14px }
    }
  </style>
</head>
<body class="theme-gradient">
  <div class="container">
    <div class="header">
      <div class="title"><span class="dot"></span> T·ªïng h·ª£p ph·∫ßn m·ªÅm</div>
      <div class="toolbar">
        <div class="theme-toggle" role="group" aria-label="ƒê·ªïi ch·ªß ƒë·ªÅ">
          <button class="toggle-btn active" data-theme="gradient" title="Gradient">Gradient</button>
          <button class="toggle-btn" data-theme="simple" title="Simple t√≠m">Simple</button>
        </div>
        <div class="control" title="T√¨m ki·∫øm theo t√™n ho·∫∑c tab">
          üîé
          <input id="search" type="search" placeholder="T√¨m theo t√™n, tab..." />
        </div>
        <div class="control" title="S·∫Øp x·∫øp theo t√™n">
          ‚ÜïÔ∏è
          <select id="sort">
            <option value="name-asc">T√™n (A ‚Üí Z)</option>
            <option value="name-desc">T√™n (Z ‚Üí A)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="status" id="status">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheet...</div>

    <div class="card" role="region" aria-label="B·∫£ng ph·∫ßn m·ªÅm">
      <table id="table">
        <thead>
          <tr>
            <th class="col-stt">STT</th>
            <th>T√™n ph·∫ßn m·ªÅm</th>
            <th>Tab</th>
            <th>Link t·∫£i xu·ªëng</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="4" class="empty">ƒêang t·∫£i...</td></tr>
        </tbody>
      </table>
      <div class="footer" id="footer">‚Äî</div>
    </div>
  </div>

  <script>
    // === CONFIG ===
    // 1) L·∫•y SHEET_ID t·ª´ URL d·∫°ng:
    //    https://docs.google.com/spreadsheets/d/<SHEET_ID>/edit#gid=...
    // 2) SHEET_NAME l√† t√™n sheet (v√≠ d·ª•: Sheet1). N·∫øu kh√¥ng ch·∫Øc, d√πng gid:
    //    th√™m tham s·ªë &gid=<GID> thay v√¨ sheet=<SHEET_NAME>
    const SHEET_ID   = "YOUR_SHEET_ID_HERE";
    const SHEET_NAME = "Sheet1"; // ƒë·ªïi n·∫øu c·∫ßn
    // N·∫øu mu·ªën d√πng gid thay cho sheet name, set SHEET_GID v√† ƒë·ªïi URL ·ªü buildGvizUrl()
    const SHEET_GID  = ""; // v√≠ d·ª• "0" (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng d√πng)

    // === STATE ===
    let rawRows = [];   // d·ªØ li·ªáu g·ªëc t·ª´ sheet
    let viewRows = [];  // d·ªØ li·ªáu sau khi l·ªçc + s·∫Øp x·∫øp
    let currentTheme = "gradient";

    // === THEME TOGGLE ===
    const themeButtons = document.querySelectorAll('.toggle-btn');
    themeButtons.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        themeButtons.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const theme = btn.dataset.theme;
        setTheme(theme);
      });
    });
    function setTheme(theme){
      currentTheme = theme;
      if(theme === 'simple'){
        document.body.classList.add('theme-simple');
      }else{
        document.body.classList.remove('theme-simple');
      }
      document.body.classList.toggle('theme-gradient', theme==='gradient');
    }

    // === GVIZ FETCH ===
    function buildGvizUrl(){
      const base = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq`;
      if(SHEET_GID && SHEET_GID.trim()!==""){
        return `${base}?gid=${encodeURIComponent(SHEET_GID)}&tqx=out:json`;
      }
      return `${base}?sheet=${encodeURIComponent(SHEET_NAME)}&tqx=out:json`;
    }

    async function fetchSheet(){
      const status = document.getElementById('status');
      try{
        const url = buildGvizUrl();
        const res = await fetch(url);
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const text = await res.text();
        // Strip Google Visualization JSONP wrapper
        const jsonStr = text.replace(/^.*setResponse\(|\);\s*$/g, '');
        const data = JSON.parse(jsonStr);
        // Expect columns: STT | T√™n ph·∫ßn m·ªÅm | Tab | Link t·∫£i xu·ªëng
        const rows = (data.table.rows || []).map(r=>{
          const c = r.c || [];
          return {
            stt:        c[0]?.v ?? "",
            name:       c[1]?.v?.toString() ?? "",
            tab:        c[2]?.v?.toString() ?? "",
            download:   c[3]?.v?.toString() ?? ""
          };
        }).filter(x => x.name || x.tab || x.download);

        if(rows.length === 0){
          status.textContent = "Kh√¥ng c√≥ d·ªØ li·ªáu (ki·ªÉm tra c·ªôt & quy·ªÅn chia s·∫ª Sheet).";
        }else{
          status.textContent = `ƒê√£ t·∫£i ${rows.length} m·ª•c.`;
        }
        rawRows = rows;
        applyFiltersAndRender();
      }catch(err){
        console.error(err);
        status.textContent = "Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu t·ª´ Google Sheet. Hi·ªÉn th·ªã d·ªØ li·ªáu m·∫´u.";
        // Fallback sample
        rawRows = [
          { stt: 1, name: "Tool ABC", tab: "Ti·ªán √≠ch", download: "https://example.com/abc.zip" },
          { stt: 2, name: "App XYZ", tab: "H·ªá th·ªëng", download: "https://example.com/xyz.exe" },
          { stt: 3, name: "Driver 123", tab: "Driver",  download: "https://example.com/driver123.msi" },
        ];
        applyFiltersAndRender();
      }
    }

    // === SEARCH + SORT ===
    const searchEl = document.getElementById('search');
    const sortEl = document.getElementById('sort');

    let searchTerm = "";
    searchEl.addEventListener('input', debounce(()=>{
      searchTerm = (searchEl.value || "").toLowerCase().trim();
      applyFiltersAndRender();
    }, 120));

    sortEl.addEventListener('change', ()=>{
      applyFiltersAndRender();
    });

    function applyFiltersAndRender(){
      const sortMode = sortEl.value;
      viewRows = rawRows.filter(r=>{
        if(!searchTerm) return true;
        const pool = `${r.name} ${r.tab}`.toLowerCase();
        return pool.includes(searchTerm);
      });

      viewRows.sort((a,b)=>{
        const A = (a.name||"").toLowerCase();
        const B = (b.name||"").toLowerCase();
        if(sortMode === 'name-asc')  return A.localeCompare(B, 'vi');
        if(sortMode === 'name-desc') return B.localeCompare(A, 'vi');
        return 0;
      });

      renderTable(viewRows);
    }

    // === RENDER ===
    function renderTable(rows){
      const tbody = document.getElementById('tbody');
      const footer = document.getElementById('footer');

      if(!rows.length){
        tbody.innerHTML = `<tr><td colspan="4" class="empty">Kh√¥ng c√≥ k·∫øt qu·∫£ ph√π h·ª£p.</td></tr>`;
        footer.textContent = "‚Äî";
        return;
      }

      const html = rows.map(r=>{
        const safeName = escapeHtml(r.name ?? "");
        const safeTab  = escapeHtml(r.tab ?? "");
        const stt = r.stt ?? "";
        const link = (r.download ?? "").trim();
        const btn = link
          ? `<a class="dl-btn" href="${encodeURIComponentLink(link)}" target="_blank" rel="noopener">
               <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                 <path d="M12 3v12m0 0 4-4m-4 4-4-4M4 21h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
               </svg>
               Download
             </a>`
          : `<span style="color:var(--muted)">‚Äî</span>`;

        return `
          <tr>
            <td class="col-stt">${stt}</td>
            <td class="name">${safeName}</td>
            <td><span class="tab-chip">#${safeTab}</span></td>
            <td>${btn}</td>
          </tr>
        `;
      }).join('');

      tbody.innerHTML = html;
      footer.textContent = `Hi·ªÉn th·ªã ${rows.length} m·ª•c`;
    }

    // === UTIL ===
    function escapeHtml(str){
      return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function encodeURIComponentLink(url){
      // gi·ªØ nguy√™n scheme v√† query, ch·ªâ encode ph·∫ßn nguy hi·ªÉm c∆° b·∫£n
      try{
        const u = new URL(url);
        return u.toString();
      }catch{
        // n·∫øu l√† ƒë∆∞·ªùng d·∫´n th√¥ (kh√¥ng h·ª£p l·ªá URL), v·∫´n tr·∫£ v·ªÅ (tr√°nh ph√° link n·ªôi b·ªô)
        return url.replace(/"/g, '%22').replace(/ /g, '%20');
      }
    }
    function debounce(fn, delay){
      let t; return (...args)=>{ clearTimeout(t); t = setTimeout(()=>fn(...args), delay); };
    }

    // Kickoff
    fetchSheet();
  </script>
</body>
</html>
