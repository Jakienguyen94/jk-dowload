<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Sheet Viewer</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <style>
    body {
      transition: background-color 0.5s ease, color 0.5s ease;
    }
    table th, table td {
      transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease;
    }
    .table-container {
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .fade-enter {
      opacity: 0;
      transform: translateX(-20px);
    }
    .fade-enter-active {
      opacity: 1;
      transform: translateX(0);
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold mb-6">Bảng dữ liệu từ Google Sheet</h1>

  <!-- Chọn màu giao diện -->
  <div class="mb-4">
    <label for="theme" class="mr-2 font-semibold">Chọn giao diện:</label>
    <select id="theme" class="p-2 border rounded">
      <option value="theme-blue">Xanh tím</option>
      <option value="theme-red">Đỏ trắng</option>
      <option value="theme-green">Xanh lá</option>
      <option value="theme-orange">Cam đen</option>
      <option value="theme-gray">Xám vàng</option>
    </select>
  </div>

  <!-- Ô tìm kiếm -->
  <div class="mb-4 w-full max-w-2xl">
    <input type="text" id="search" placeholder="Tìm kiếm..." class="w-full p-2 border rounded" />
  </div>

  <!-- Bảng dữ liệu -->
  <div id="tableContainer" class="table-container w-full max-w-4xl overflow-x-auto shadow-lg rounded-lg">
    <table id="dataTable" class="min-w-full border rounded-lg overflow-hidden">
      <thead>
        <tr></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Phân trang -->
  <div id="pagination" class="mt-4 flex space-x-2"></div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const SHEET_ID = "YOUR_SHEET_ID"; // Thay ID Google Sheet
    const GID = "0"; // Thay bằng gid sheet của bạn
    const API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;

    const rowsPerPage = 10;
    let currentPage = 1;
    let tableData = [];

    async function fetchData() {
      try {
        const res = await axios.get(API_URL);
        const json = JSON.parse(res.data.substr(47).slice(0, -2));
        const cols = json.table.cols.map(c => c.label);
        const rows = json.table.rows.map(r => r.c.map(c => (c ? c.v : "")));
        renderTable(cols, rows);
      } catch (err) {
        console.error("Lỗi tải dữ liệu", err);
      }
    }

    function renderTable(headers, rows) {
      tableData = rows;
      const thead = document.querySelector("#dataTable thead tr");
      thead.innerHTML = "";
      headers.forEach((h, i) => {
        const th = document.createElement("th");
        th.className = "px-4 py-2 border cursor-pointer";
        th.innerHTML = `<i class='bx bx-sort-alt-2'></i> ${h}`;
        th.onclick = () => sortTable(i);
        thead.appendChild(th);
      });
      renderPage(1);
    }

    function renderPage(page) {
      currentPage = page;
      const start = (page - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const rows = tableData.slice(start, end);
      const tbody = document.querySelector("#dataTable tbody");

      // Hiệu ứng fade + slide
      const tableContainer = document.querySelector("#tableContainer");
      tableContainer.classList.add("fade-enter");
      setTimeout(() => {
        tbody.innerHTML = "";
        rows.forEach(r => {
          const tr = document.createElement("tr");
          r.forEach(cell => {
            const td = document.createElement("td");
            td.className = "px-4 py-2 border";
            td.textContent = cell;
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        renderPagination();
        tableContainer.classList.remove("fade-enter");
        tableContainer.classList.add("fade-enter-active");
        setTimeout(() => tableContainer.classList.remove("fade-enter-active"), 500);
      }, 100);
    }

    function renderPagination() {
      const totalPages = Math.ceil(tableData.length / rowsPerPage);
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded ${i === currentPage ? 'bg-blue-500 text-white' : 'bg-gray-200'}`;
        btn.onclick = () => renderPage(i);
        pagination.appendChild(btn);
      }
    }

    function sortTable(colIndex) {
      tableData.sort((a, b) => (a[colIndex] > b[colIndex] ? 1 : -1));
      renderPage(1);
    }

    document.getElementById("search").addEventListener("input", e => {
      const keyword = e.target.value.toLowerCase();
      const filtered = tableData.filter(r => r.some(c => String(c).toLowerCase().includes(keyword)));
      tableData = filtered.length ? filtered : [];
      renderPage(1);
    });

    // Đổi theme
    const themes = {
      "theme-blue": { header: "bg-blue-600 text-white", row: "bg-blue-50" },
      "theme-red": { header: "bg-red-600 text-white", row: "bg-red-50" },
      "theme-green": { header: "bg-green-600 text-white", row: "bg-green-50" },
      "theme-orange": { header: "bg-yellow-600 text-black", row: "bg-yellow-50" },
      "theme-gray": { header: "bg-gray-700 text-yellow-300", row: "bg-gray-100" }
    };

    document.getElementById("theme").addEventListener("change", e => {
      const theme = themes[e.target.value];
      const ths = document.querySelectorAll("#dataTable thead th");
      ths.forEach(th => {
        th.className = `px-4 py-2 border cursor-pointer ${theme.header}`;
      });
      const tds = document.querySelectorAll("#dataTable tbody td");
      tds.forEach(td => {
        td.className = `px-4 py-2 border ${theme.row}`;
      });
    });

    fetchData();
  </script>
</body>
</html>
