<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Báº£ng tá»« Google Sheets</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash/lodash.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 p-4">

  <div class="max-w-7xl mx-auto">
    <h1 class="text-xl font-bold mb-4">Dá»¯ liá»‡u tá»« Google Sheets</h1>
    <div class="overflow-x-auto rounded-xl shadow">
      <table class="min-w-full border-collapse">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- PhÃ¢n trang -->
    <div class="flex items-center justify-between mt-3">
      <div>
        <button id="prevPage" class="px-3 py-1 bg-slate-700 rounded hover:bg-slate-600">TrÆ°á»›c</button>
        <span id="pageInfo" class="px-2"></span>
        <button id="nextPage" class="px-3 py-1 bg-slate-700 rounded hover:bg-slate-600">Sau</button>
      </div>
      <div id="statusText" class="text-sm text-slate-400"></div>
    </div>
  </div>

  <script>
    const SHEET_ID = "YOUR_SHEET_ID"; // ðŸ”½ thay ID Google Sheet
    const API_KEY = "YOUR_API_KEY";   // ðŸ”½ thay API Key
    const RANGE = "Sheet1!A:Z";       // ðŸ”½ pháº¡m vi dá»¯ liá»‡u

    const state = {
      rows: [],
      columns: [],
      page: 1,
      pageSize: 10,
      sortKey: null,
      sortAsc: true,
    };

    async function fetchData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      const res = await axios.get(url);
      const values = res.data.values || [];
      if (!values.length) return;

      const headers = values[0];
      const rows = values.slice(1).map(r => {
        const obj = {};
        headers.forEach((h, i) => obj[h] = r[i] || "");
        return obj;
      });

      state.columns = headers.map(h => ({ key: h, label: h }));
      state.rows = rows;

      renderHeader();
      renderBody();
    }

    function getFilteredSortedRows() {
      let rows = [...state.rows];
      if (state.sortKey) {
        rows.sort((a, b) => {
          const av = a[state.sortKey] || "";
          const bv = b[state.sortKey] || "";
          return state.sortAsc ? av.localeCompare(bv) : bv.localeCompare(av);
        });
      }
      return rows;
    }

    function toggleSort(key) {
      if (state.sortKey === key) {
        state.sortAsc = !state.sortAsc;
      } else {
        state.sortKey = key;
        state.sortAsc = true;
      }
      renderBody();
    }

    function renderHeader() {
      const thead = document.getElementById("thead");
      thead.innerHTML = "";

      const tr = document.createElement("tr");
      tr.className = "bg-slate-700 text-slate-100";

      // ðŸ”½ cá»™t STT
      const thStt = document.createElement("th");
      thStt.className = "px-3 md:px-4 py-2 text-left text-sm font-medium";
      thStt.textContent = "STT";
      tr.appendChild(thStt);

      for (const col of state.columns) {
        const th = document.createElement("th");
        th.className = "px-3 md:px-4 py-2 text-left text-sm font-medium cursor-pointer hover:bg-slate-600";
        th.textContent = col.label;
        th.onclick = () => toggleSort(col.key);
        tr.appendChild(th);
      }
      thead.appendChild(tr);
    }

    function renderBody() {
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";

      const rows = getFilteredSortedRows();
      const total = rows.length;
      const pageSize = state.pageSize;
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      state.page = Math.min(state.page, totalPages);
      const start = (state.page - 1) * pageSize;
      const pageRows = rows.slice(start, start + pageSize);

      pageRows.forEach((r, i) => {
        const tr = document.createElement("tr");
        tr.className = "hover:bg-white/5 transition";

        // ðŸ”½ thÃªm STT
        const tdStt = document.createElement("td");
        tdStt.className = "px-3 md:px-4 py-2 text-sm text-slate-100/90 font-medium";
        tdStt.textContent = start + i + 1;
        tr.appendChild(tdStt);

        for (const col of state.columns) {
          const td = document.createElement("td");
          td.className = "px-3 md:px-4 py-2 align-top text-sm text-slate-100/90";
          const val = r[col.key] ?? "";

          // ðŸ”½ náº¿u lÃ  link thÃ¬ hiá»‡n nÃºt Download
          if (/https?:\/\//.test(val)) {
            td.innerHTML = `
              <a href="${val}" target="_blank" 
                 class="inline-flex items-center gap-1 px-3 py-1 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm transition">
                <i data-lucide="download" class="w-4 h-4"></i>
                Download
              </a>
            `;
          } else {
            td.textContent = val;
          }
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      });

      document.getElementById("pageInfo").textContent = `${state.page} / ${totalPages}`;
      document.getElementById("prevPage").disabled = state.page <= 1;
      document.getElementById("nextPage").disabled = state.page >= totalPages;
      document.getElementById("statusText").textContent = `${total} dÃ²ng, ${state.columns.length} cá»™t`;

      window.lucide?.createIcons();
    }

    document.getElementById("prevPage").onclick = () => {
      if (state.page > 1) {
        state.page--;
        renderBody();
      }
    };
    document.getElementById("nextPage").onclick = () => {
      state.page++;
      renderBody();
    };

    fetchData();
  </script>
</body>
</html>
